<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The KetoFit Program</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: auto; }
        .language-switch { margin-bottom: 20px; }
        .quiz, .results { display: none; }
        .quiz.active, .results.active { display: block; }
        [lang]:not(.active) { display: none !important; }
        button { padding: 10px; margin: 5px; cursor: pointer; }
        .error { color: red; }
        .links { margin-top: 20px; }
        a { margin-right: 10px; }
    </style>
</head>
<body>
    <!-- Force Rebuild: 2025-06-22 07:52 EDT -->
    <div class="container">
        <div class="language-switch">
            <button data-lang="en" onclick="switchLanguage('en')">English</button>
            <button data-lang="zh" onclick="switchLanguage('zh')">简体中文</button>
        </div>

        <h1 lang="en">Welcome to The KetoFit Program</h1>
        <h1 lang="zh">欢迎体验 KetoFit 计划</h1>
        <p lang="en">Embrace an ancestral carnivore-keto lifestyle with personalized meal and exercise plans.</p>
        <p lang="zh">拥抱祖先肉食-生酮生活方式，享受个性化饮食和锻炼计划。</p>
        <button data-action="quiz" lang="en" onclick="showQuiz()">Take the Quiz</button>
        <button data-action="quiz" lang="zh" onclick="showQuiz()">开始测评</button>

        <div id="quiz" class="quiz">
            <h2 lang="en">Personal Assessment Quiz</h2>
            <h2 lang="zh">个人评估测评</h2>
            <form id="assessmentForm">
                <label lang="en">Gender: 
                    <select name="gender" required>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </label>
                <label lang="zh">性别: 
                    <select name="gender" required>
                        <option value="male">男</option>
                        <option value="female">女</option>
                        <option value="other">其他</option>
                    </select>
                </label><br>
                <label lang="en">Age: <input type="number" name="age" min="18" max="100" required></label>
                <label lang="zh">年龄: <input type="number" name="age" min="18" max="100" required></label><br>
                <label lang="en">Height (cm): <input type="number" name="height" required></label>
                <label lang="zh">身高 (厘米): <input type="number" name="height" required></label><br>
                <label lang="en">Weight (kg): <input type="number" name="weight" required></label>
                <label lang="zh">体重 (公斤): <input type="number" name="weight" required></label><br>
                <label lang="en">Activity Level: 
                    <select name="activityLevel" required>
                        <option value="everyday">Every day</option>
                        <option value="1-2week">1-2 times a week</option>
                        <option value="couplemonth">A couple times a month</option>
                    </select>
                </label>
                <label lang="zh">活动水平: 
                    <select name="activityLevel" required>
                        <option value="everyday">每天</option>
                        <option value="1-2week">每周1-2次</option>
                        <option value="couplemonth">每月几次</option>
                    </select>
                </label><br>
                <label lang="en">Body Type: 
                    <select name="bodyType" required>
                        <option value="overweight">Overweight</option>
                        <option value="chubbysoft">Chubby/Soft</option>
                        <option value="slim">Slim</option>
                        <option value="skinny">Skinny</option>
                    </select>
                </label>
                <label lang="zh">体型: 
                    <select name="bodyType" required>
                        <option value="overweight">超重</option>
                        <option value="chubbysoft">圆润/柔软</option>
                        <option value="slim">苗条</option>
                        <option value="skinny">瘦弱</option>
                    </select>
                </label><br>
                <label lang="en">Fitness Goal: 
                    <select name="goal" required>
                        <option value="idealweight">Ideal Weight</option>
                        <option value="toneup">Tone Up</option>
                        <option value="getlean">Get Lean</option>
                    </select>
                </label>
                <label lang="zh">健身目标: 
                    <select name="goal" required>
                        <option value="idealweight">理想体重</option>
                        <option value="toneup">紧实身材</option>
                        <option value="getlean">减脂</option>
                    </select>
                </label><br>
                <label lang="en">Meal Preferences (e.g., beef, lamb): <input type="text" name="mealPrefs" placeholder="e.g., beef, lamb" required></label>
                <label lang="zh">饮食偏好 (如牛肉, 羊肉): <input type="text" name="mealPrefs" placeholder="如牛肉, 羊肉" required></label><br>
                <button type="submit" lang="en">Submit</button>
                <button type="submit" lang="zh">提交</button>
            </form>
            <p class="error" id="jsError" style="display:none;">JavaScript error. Check console.</p>
        </div>

        <div id="results" class="results">
            <h2 lang="en">Your Personalized KetoFit Plan</h2>
            <h2 lang="zh">您的个性化 KetoFit 计划</h2>
            <p id="planDetails" lang="en"></p>
            <p id="planDetails" lang="zh"></p>
            <a id="downloadLink" href="#" download="KetoFit_Plan.pdf" lang="en">Download Plan</a>
            <a id="downloadLink" href="#" download="KetoFit_Plan.pdf" lang="zh">下载计划</a>
        </div>

        <div id="about">
            <h2 lang="en">About Us</h2>
            <h2 lang="zh">关于我们</h2>
            <p lang="en">KetoFit blends ancestral carnivore and keto principles, prioritizing meat, low-inflammation plants, and moderate low-sugar fruits, supported by science from the Journal of Nutrition and American Journal of Clinical Nutrition (2025). We optimize plans with AI for health and longevity, emphasizing sleep, creatine, and amino acids.</p>
            <p lang="zh">KetoFit 融合祖先肉食和生酮原则，优先考虑肉类、低炎症植物和适量低糖水果，得到《营养学杂志》和《美国临床营养学杂志》(2025) 的科学支持。我们利用人工智能优化计划，强调睡眠、肌酸和氨基酸。</p>
        </div>

        <div class="links">
            <a href="privacy.html" lang="en">Privacy Policy</a>
            <a href="privacy.html" lang="zh">隐私政策</a>
            <a href="terms.html" lang="en">Terms of Use</a>
            <a href="terms.html" lang="zh">使用条款</a>
        </div>
    </div>

    <script>
        // Global variables
        let currentLang = 'en';

        // Thesis data based on ancestral carnivore-keto and exercise principles
        const thesisData = {
            nutrition: {
                baseProteinRatio: { // g per kg body weight, adjusted by body type
                    overweight: 1.2,
                    chubbysoft: 1.1,
                    slim: 1.0,
                    skinny: 1.3
                },
                highExerciseProteinBonus: 0.3, // Additional g per kg on high activity days
                carbLimit: 30, // Low-carb threshold (g/day)
                fatRatio: 0.7, // g per kg body weight for keto fat intake
                foods: {
                    meats: ['beef', 'lamb', 'chicken', 'bison', 'goat', 'fish'],
                    plants: ['spinach', 'kale', 'zucchini', 'broccoli'],
                    fruits: ['blueberries', 'raspberries', 'blackberries']
                },
                meals: {
                    breakfast: [
                        'Scrambled eggs with bacon and spinach', 'Lamb sausage with kale', 'Bison patties with zucchini',
                        'Chicken liver with broccoli', 'Fish omelette with berries', 'Beef mince with spinach',
                        'Goat cheese scramble', 'Salmon with kale', 'Chicken thigh with zucchini', 'Bison steak with spinach',
                        'Lamb chop with broccoli', 'Fish with berries', 'Beef sausage with kale', 'Chicken with spinach',
                        'Goat meat with zucchini', 'Salmon scramble', 'Bison with broccoli', 'Lamb with berries',
                        'Chicken with kale', 'Fish with spinach'
                    ],
                    lunch: [
                        'Beef stir-fry with broccoli', 'Lamb with spinach', 'Chicken salad with kale',
                        'Bison bowl with zucchini', 'Fish with asparagus', 'Goat stew with spinach',
                        'Salmon with broccoli', 'Beef with berries', 'Chicken with kale', 'Bison with zucchini',
                        'Lamb with spinach', 'Fish with broccoli', 'Goat with asparagus', 'Salmon with kale',
                        'Beef with spinach', 'Chicken with berries', 'Bison with broccoli', 'Lamb with zucchini',
                        'Goat with kale', 'Fish with spinach'
                    ],
                    dinner: [
                        'Beef ribs with cauliflower mash', 'Lamb roast with spinach', 'Chicken with broccoli',
                        'Bison steak with kale', 'Fish with zucchini', 'Goat curry with asparagus',
                        'Salmon with spinach', 'Beef with berries', 'Chicken with kale', 'Bison with broccoli',
                        'Lamb with zucchini', 'Fish with spinach', 'Goat with broccoli', 'Salmon with asparagus',
                        'Beef with kale', 'Chicken with spinach', 'Bison with berries', 'Lamb with broccoli',
                        'Goat with zucchini', 'Fish with kale'
                    ]
                },
                supplements: ['creatine (5g/day)', 'L-glutamine (5g/day)', 'sleep (7-9h/night)']
            },
            exercise: {
                intensity: {
                    everyday: 'High (5-6 days/week)',
                    '1-2week': 'Moderate (2-3 days/week)',
                    couplemonth: 'Low (1-2 days/week)'
                },
                routines: {
                    idealweight: ['Squats, Lunges, Walking'],
                    toneup: ['Squats, Push-Ups, Plank'],
                    getlean: ['Squats, Burpees, Jumping Jacks']
                },
                gymOptions: ['Leg Press', 'Squat Rack', 'Deadlift']
            }
        };

        // Functions
        function switchLanguage(lang) {
            if (!lang || lang === currentLang) return;
            currentLang = lang;
            console.log('Switching to:', lang);
            const elements = document.querySelectorAll('[lang]');
            if (!elements.length) {
                console.error('No language elements found');
                document.getElementById('jsError').style.display = 'block';
                return;
            }
            elements.forEach(el => {
                el.classList.remove('active');
                if (el.getAttribute('lang') === lang) el.classList.add('active');
            });
            console.log('Active elements:', document.querySelectorAll('[lang].active').length);
            if (document.querySelectorAll('[lang].active').length === 0) {
                document.querySelectorAll(`[lang="${lang}"]`).forEach(el => el.classList.add('active'));
                console.log('Fallback applied for:', lang);
            }
        }

        function showQuiz() {
            const quiz = document.getElementById('quiz');
            if (quiz) {
                quiz.classList.add('active');
                console.log('Quiz displayed');
            } else {
                console.error('Quiz element not found');
                document.getElementById('jsError').style.display = 'block';
            }
        }

        function generateMealPlan(preferences, goal) {
            const bodyType = document.querySelector('select[name="bodyType"]').value;
            const weight = parseFloat(document.querySelector('input[name="weight"]').value);
            const activityLevel = document.querySelector('select[name="activityLevel"]').value;
            const baseProtein = thesisData.nutrition.baseProteinRatio[bodyType] * weight;
            const extraProtein = (activityLevel === 'everyday' ? thesisData.nutrition.highExerciseProteinBonus * weight : 0);
            const proteinTarget = baseProtein + extraProtein;
            const carbLimit = thesisData.nutrition.carbLimit;
            const fatTarget = thesisData.nutrition.fatRatio * weight;
            const mealCategory = thesisData.nutrition.meals[goal === 'idealweight' ? 'breakfast' : goal === 'toneup' ? 'lunch' : 'dinner'].slice(0, 5); // Sample subset
            return `Target: ${proteinTarget.toFixed(1)}g protein, ${carbLimit}g carbs, ${fatTarget.toFixed(1)}g fat. Meals: ${mealCategory.join(', ')} with ${preferences.join(', ')}, ${thesisData.nutrition.fruits.join(', ')} in moderation. Supplements: ${thesisData.nutrition.supplements.join(', ')}. Track: Weekly weight, energy levels.`;
        }

        function generateExercisePlan(activityLevel, goal) {
            const intensity = thesisData.exercise.intensity[activityLevel];
            const routine = thesisData.exercise.routines[goal];
            const gymOption = thesisData.exercise.gymOptions[Math.floor(Math.random() * thesisData.exercise.gymOptions.length)];
            return `Intensity: ${intensity}. Routine: ${routine.join(', ')}. Gym Option: ${gymOption}. Track: Strength gains, endurance, sleep quality.`;
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded at:', new Date().toLocaleTimeString());
            if (!document.querySelector('script')) console.error('Script tag not found');
            document.querySelectorAll('[data-lang]').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    console.log('Language button clicked:', button.getAttribute('data-lang'));
                    switchLanguage(button.getAttribute('data-lang'));
                });
            });

            document.querySelectorAll('[data-action="quiz"]').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    console.log('Quiz button clicked');
                    showQuiz();
                });
            });

            const assessmentForm = document.getElementById('assessmentForm');
            if (assessmentForm) {
                assessmentForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    console.log('Form submitted at:', new Date().toLocaleTimeString(), 'Data:', Object.fromEntries(new FormData(assessmentForm)));
                    const formData = new FormData(assessmentForm);
                    const data = Object.fromEntries(formData);

                    const required = ['gender', 'age', 'height', 'weight', 'activityLevel', 'bodyType', 'goal', 'mealPrefs'];
                    const missing = required.filter(field => !data[field] || data[field].trim() === '');
                    if (missing.length > 0) {
                        console.error('Missing fields:', missing);
                        document.getElementById('jsError').textContent = `请填写所有字段: ${missing.join(', ')}.`;
                        document.getElementById('jsError').style.display = 'block';
                        return;
                    }

                    const numericFields = { weight: data.weight, height: data.height, age: data.age };
                    for (let field in numericFields) {
                        if (isNaN(parseFloat(numericFields[field]))) {
                            console.error(`${field} is not a number`);
                            document.getElementById('jsError').textContent = `${field} 必须是数字.`;
                            document.getElementById('jsError').style.display = 'block';
                            return;
                        }
                    }

                    const mealPlan = generateMealPlan(data.mealPrefs.split(',').map(p => p.trim()), data.goal);
                    const exercisePlan = generateExercisePlan(data.activityLevel, data.goal);

                    const planDetailsEn = document.querySelector('#planDetails[lang="en"]');
                    const planDetailsZh = document.querySelector('#planDetails[lang="zh"]');
                    const downloadLink = document.getElementById('downloadLink');
                    if (planDetailsEn && planDetailsZh && downloadLink) {
                        planDetailsEn.innerHTML = `
                            <h3>Meal Plan</h3><p>${mealPlan}</p>
                            <h3>Exercise Plan</h3><p>${exercisePlan}</p>
                            <p>Pay <a href="mailto:support@ketofit.com?subject=Purchase Plan">here</a> for 20 breakfast, 20 lunch, 20 dinner options.</p>
                        `;
                        planDetailsZh.innerHTML = `
                            <h3>饮食计划</h3><p>${mealPlan}</p>
                            <h3>锻炼计划</h3><p>${exercisePlan}</p>
                            <p>支付 <a href="mailto:support@ketofit.com?subject=Purchase Plan">这里</a> 获取20个早餐、20个午餐、20个晚餐选项。</p>
                        `;
                        document.getElementById('results').classList.add('active');
                        downloadLink.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(`KetoFit Plan\n\n${currentLang === 'en' ? planDetailsEn.innerHTML : planDetailsZh.innerHTML}`);
                        console.log('Results displayed at:', new Date().toLocaleTimeString());
                    } else {
                        console.error('Result elements not found:', { planDetailsEn, planDetailsZh, downloadLink });
                        document.getElementById('jsError').style.display = 'block';
                    }
                });
            } else {
                console.error('Assessment form not found');
                document.getElementById('jsError').style.display = 'block';
            }

            document.querySelectorAll('[lang="en"]').forEach(el => el.classList.add('active'));
            console.log('Initialized with English, active elements:', document.querySelectorAll('[lang].active').length);
        });
    </script>
</body>
</html>
